First of all make sure that ND280 Software is installed and the environment is loaded (source Run_At_Start_T2K.sh and nd280upgrade.sh)

go to t2k-nd280-upgrade-master and do:


0.) Set the environment

source T2KND280Up.sh $PWD --> for internal GEANT4 CLHEP
source T2KND280Up_CLHEP.sh $PWD --> for external CLHEP


1.) To build the code do:

cd $ND280UPGRADEPATH/build
cmake ../src/
make -jN (N = # of cores)


2.) Additional building options can be added by passing extra -D command line arguments to CMake.
    The available options are listed below:

 * _USE_CPP11 : Set to "ON" to enable c++11 support.
 * _MY_ND280MC_INCLUDE_DIR : Full path to the include files of a stand-alone (customized) version of the nd280mc package.
 * _MY_ND280MC_LIBRARY_DIR : Full path to the library file of a stand-alone (customized) version of the nd280mc package.
 * _MY_OAEVENT_INCLUDE_DIR : Full path to the include files of a stand-alone (customized) version of the oaEvent package.
 * _MY_OAEVENT_LIBRARY_DIR : Full path to the library file of a stand-alone (customized) version of the oaEvent package.
 * _MY_INGRIDUTILS_INCLUDE_DIR : Full path to the include files of a stand-alone (customized) version of the ingridUtils package.
 * _MY_INGRIDUTILS_LIBRARY_DIR : Full path to the library file of a stand-alone (customized) version of the ingridUtils package.

 example:

cmake -D_MY_ND280MC_INCLUDE_DIR=/home/yordan/T2K/work/nd280mc-up/src/ \
      -D_MY_ND280MC_LIBRARY_DIR=/home/yordan/T2K/work/nd280mc-up/lib/ \
      -D_USE_CPP11=ON \
      ../src/


3.) To run the code do:

cd $T2KND280UP/bin 
./EffStudy.exe $T2KND280UP_SRC/vis.mac (or any other input file)

The following output files are produced:

- EffStudy.root: root file containing the GEANT4 output tree
- g4_*.wrl: VRML files with event display
- geometry.root: root file containing the detector geometry


4.) Add packages

In order to add packages to be compiled you need to:

### open $T2KND280UP/src/CMakeLists.txt and add (or replace)

INCLUDE_DIRECTORIES(${CMAKE_BINARY_DIR}/../src/app/PATH_TO_INCLUDE) ### header files

### open  $T2KND280UP/src/app/CMakeLists.txt and add (or replace)

AUX_SOURCE_DIRECTORY(EffStudy/src sourcefile) ###

ADD_EXECUTABLE(EffStudy.exe          EffStudy/Main.cc ${sourcefile}) ###

TARGET_LINK_LIBRARIES(EffStudy.exe   ${ROOT_LIBRARIES}
				     ...           )


5.) Installation

In order to get this framework working the following software need to be installed in the following order:

- Xerces-C++: needed to store the geometry in GDML format. Installed xerces-c-3.1.3 with default configuration options
 
- CLHEP: Install version 2.2.0.4 (recommended for GEANT4.10.1.3)

- GEANT4: the cmake must be configured with the following options: USE_GDML=ON, INSTALL_DATA=ON, XERCESC_ROOT_DIR=/path/to/install (contains lib, bin and include directories), DGEANT4_USE_SYSTEM_CLHEP and DCLHEP_ROOT_DIR. For this framework the version geant4.10.01.p03 is recommended.

cmake -DCMAKE_INSTALL_PREFIX=/atlas/users/dsgalabe/GEANT4/geant4.10.01.p03-install /atlas/users/dsgalabe/GEANT4/geant4.10.01.p03 -DGEANT4_USE_GDML=ON -DGEANT4_INSTALL_DATA=ON -DXERCESC_ROOT_DIR=/atlas/users/dsgalabe/xerces-c-3.1.3 -DGEANT4_USE_SYSTEM_CLHEP=ON -DCLHEP_ROOT_DIR=/atlas/users/dsgalabe/CLHEP/clhep_install/

- VGML: before installing it GEANT4 environment must be set. The source of T2KND280Up.sh as in 0.) is enough. 
  If CLHEP is external to GEANT4 you need to modify the FindCLHEP.cmake file in order to find the CLHEP external variables: 
  find_path(... libCLHEP.dylib ...) --> remove libCLHEP.dylib, useful only for MacOS
  find_path(...) CLHEP_LIB_DIR --> $ENV{CLHEP_LIB_DIR}






# Enabling GDML --> need Xerces-c

cmake -DCMAKE_INSTALL_PREFIX=/atlas/users/dsgalabe/GEANT4/geant4.10.01.p03-install -DGEANT4_USE_GDML=ON -DGEANT4_INSTALL_DATA=ON -DXERCESC_ROOT_DIR=/atlas/users/dsgalabe/xerces-c-3.1.3/xerces-c-3.1.3-install -XERCESC_INCLUDE_DIR=/atlas/users/dsgalabe/xerces-c-3.1.3/xerces-c-3.1.3-install/include -XERCESC_LIBRARY=/atlas/users/dsgalabe/xerces-c-3.1.3/xerces-c-3.1.3-install/lib/libxerces-c-3.1.so -DGEANT4_USE_SYSTEM_CLHEP=ON -DCLHEP_ROOT_DIR=/atlas/users/dsgalabe/CLHEP/clhep_install/ /atlas/users/dsgalabe/GEANT4/geant4.10.01.p03



# Without GDML --> don't need Xerces-c

cmake -DCMAKE_INSTALL_PREFIX=/atlas/users/dsgalabe/GEANT4/geant4.10.01.p03-install -DGEANT4_INSTALL_DATA=ON -DGEANT4_USE_SYSTEM_CLHEP=ON -DCLHEP_ROOT_DIR=/atlas/users/dsgalabe/CLHEP/clhep_install/ /atlas/users/dsgalabe/GEANT4/geant4.10.01.p03